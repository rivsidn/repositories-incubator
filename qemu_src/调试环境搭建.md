

## 源码编译

### 前期配置

```bash
 # 只编译一个x86_64架构
 ./configure --python=/usr/bin/python2 --disable-werror --target-list=x86_64-softmmu
```

### 代码调整

```diff
diff --git a/qga/commands-posix.c b/qga/commands-posix.c
index 73d93eb5ce..1f8bfc224d 100644
--- a/qga/commands-posix.c
+++ b/qga/commands-posix.c
@@ -39,6 +39,7 @@ extern char **environ;
 #include <ifaddrs.h>
 #include <arpa/inet.h>
 #include <sys/socket.h>
+#include <sys/sysmacros.h>
 #include <net/if.h>

 #ifdef FIFREEZE
diff --git a/util/memfd.c b/util/memfd.c
index 4571d1aba8..5bfd0d3770 100644
--- a/util/memfd.c
+++ b/util/memfd.c
@@ -37,7 +37,7 @@
 #include <sys/syscall.h>
 #include <asm/unistd.h>

-static int memfd_create(const char *name, unsigned int flags)
+static int memfd_create_local(const char *name, unsigned int flags)
 {
 #ifdef __NR_memfd_create
     return syscall(__NR_memfd_create, name, flags);
@@ -71,12 +71,12 @@ void *qemu_memfd_alloc(const char *name, size_t size, unsigned int seals,

 #ifdef CONFIG_LINUX
     if (seals) {
-        mfd = memfd_create(name, MFD_ALLOW_SEALING | MFD_CLOEXEC);
+        mfd = memfd_create_local(name, MFD_ALLOW_SEALING | MFD_CLOEXEC);
     }

     if (mfd == -1) {
         /* some systems have memfd without sealing */
-        mfd = memfd_create(name, MFD_CLOEXEC);
+        mfd = memfd_create_local(name, MFD_CLOEXEC);
         seals = 0;
     }
 #endif
```

